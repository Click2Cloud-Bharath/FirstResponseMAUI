<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:controls="clr-namespace:FirstResponseMAUI.Controls"
             xmlns:effects="clr-namespace:FirstResponseMAUI.Effects"
             xmlns:behaviors="clr-namespace:FirstResponseMAUI.Behaviors"
             xmlns:templates="clr-namespace:FirstResponseMAUI.Views.Templates"
             x:Class="FirstResponseMAUI.Views.NewTicketPopupView"
             Color="#80FFFFFF"
             CanBeDismissedByTappingOutsideOfPopup="False">
    <toolkit:Popup.Resources>
        <ResourceDictionary>
          
            <Style x:Key="IdentifyLogoStyle" TargetType="Image">
                <Setter Property="VerticalOptions" Value="Center"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
            </Style>
          
            <Style x:Key="IdentifyCloseButtonStyle" TargetType="Image">
                <Setter Property="VerticalOptions" Value="Start"/>
                <Setter Property="Margin" Value="0,10,0,0"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
            </Style>
          
            <Style x:Key="IdentifyHeaderStyle" TargetType="Label">
                <Setter Property="VerticalOptions" Value="Center"/>
                <Setter Property="HorizontalOptions" Value="Start"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="FontSize" Value="18"/>
                <Setter Property="FontFamily" Value="TitilliumLight" />
            </Style>
          
            <Style x:Key="SeparatorStyle" TargetType="BoxView">
                <Setter Property="HeightRequest" Value="1" />
                <Setter Property="Margin" Value="0,10,0,0"/>
                <Setter Property="Color" Value="{StaticResource GrayColor}" />
            </Style>
          
            <Style x:Key="EntryStyle" TargetType="{x:Type Entry}" >
                <Setter Property="TextColor" Value="{StaticResource LightGrayColor}" />
                <Setter Property="BackgroundColor" Value="{StaticResource DarkGrayColor}" />
                <Setter Property="HorizontalOptions" Value="FillAndExpand" />
                <Setter Property="HeightRequest" Value="54" />
                <Setter Property="Margin" Value="0, 10, 0, 0"/>
                <Setter Property="effects:ApplyFormEntryNativeStyleEffect.ApplyFormEntryNativeStyle" Value="True" />
            </Style>
          
            <Style x:Key="PickerStyle" TargetType="{x:Type Picker}" >
                <Setter Property="TextColor" Value="{StaticResource LightGrayColor}" />
                <Setter Property="BackgroundColor" Value="{StaticResource DarkGrayColor}" />
                <Setter Property="HorizontalOptions" Value="FillAndExpand" />
                <Setter Property="HeightRequest" Value="45" />
                <Setter Property="effects:ApplyFormEntryNativeStyleEffect.ApplyFormEntryNativeStyle" Value="True" />
            </Style>
          
            <Style x:Key="TrafficPickerStyle" TargetType="{x:Type Picker}" BasedOn="{StaticResource PickerStyle}">
                <Setter Property="effects:ApplyFormEntryNativeStyleEffect.PlaceHolderText" Value="Select Traffic Violation" />
            </Style>
          
            <Style x:Key="TicketLabelStyle" TargetType="{x:Type Label}" >
                <Setter Property="FontSize" Value="10"/>
                <Setter Property="Margin" Value="0, 10, 0, 0"/>
                <Setter Property="TextColor" Value="{StaticResource GrayColor}"/>
                <Setter Property="VerticalOptions" Value="Center"/>
                <Setter Property="HorizontalOptions" Value="Start"/>
                <Setter Property="FontFamily" Value="TitilliumRegular" />
            </Style>
          
            <Style x:Key="TicketLabelValueStyle" TargetType="{x:Type Label}" >
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Margin" Value="0, 1, 0, 0"/>
                <Setter Property="TextColor" Value="{StaticResource LightGrayColor}"/>
                <Setter Property="VerticalOptions" Value="Center"/>
                <Setter Property="HorizontalOptions" Value="Start"/>
                <Setter Property="FontFamily" Value="TitilliumRegular" />
            </Style>

        </ResourceDictionary>
    </toolkit:Popup.Resources>
    <Grid ColumnSpacing="0"
          HeightRequest="650"
          WidthRequest="500"
          HorizontalOptions="Center"
          VerticalOptions="Center"
          BackgroundColor="{StaticResource DarkGrayColor}"
          RowSpacing="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="65"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid Grid.Row="0"
              BackgroundColor="{StaticResource TerciaryDarkGray}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="45"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
            </Grid.ColumnDefinitions>
            <Image Grid.Column="0"
                   WidthRequest="15"
                   Style="{StaticResource IdentifyLogoStyle}"
                   Source="suspect_ico_new_ticket.png">
            </Image>
            <Label Grid.Column="1"
                   Text="New Ticket"
                   Style="{StaticResource IdentifyHeaderStyle}" />
            <Grid
                HorizontalOptions="End"
                WidthRequest="50"
                Grid.Column="2">
                <Image
                    HorizontalOptions="Center"
                    WidthRequest="15"
                    Style="{StaticResource IdentifyCloseButtonStyle}"
                    Source="ico_close_white.png">
                </Image>
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer
                        Command="{Binding ClosePopupCommand}"
                        NumberOfTapsRequired="1" />
                </Grid.GestureRecognizers>
            </Grid>
        </Grid>
        <controls:NoBarsScrollViewer Grid.Row="1">
            <StackLayout Padding="25,30,25,20"
                         Spacing="0">
                <controls:BindablePicker ItemsSource="{Binding TicketTypes}"
                                         SelectedItem="{Binding Ticket.Type}"
                                         Style="{StaticResource PickerStyle}" />
                <Label Text="Issuing Officer"
                       Style="{StaticResource TicketLabelStyle}"/>
                <Label Text="{Binding Ticket.Officer}"
                       Style="{StaticResource TicketLabelValueStyle}"/>
                <Label Text="Location"
                       Style="{StaticResource TicketLabelStyle}"/>
                <Label Text="{Binding Location}"
                       Style="{StaticResource TicketLabelValueStyle}"/>
                <Label Text="Time"
                       Style="{StaticResource TicketLabelStyle}"/>
                <Label Text="{Binding Ticket.DateCreated, StringFormat='{0:F}'}"
                       Style="{StaticResource TicketLabelValueStyle}"/>
                <Entry Text="{Binding Ticket.Driver.Name, Mode=TwoWay}"
                       Placeholder="Driver"
                       Style="{StaticResource EntryStyle}" />
                <Entry Text="{Binding Ticket.Driver.LicenceNo}"
                       Placeholder="License No"
                       Style="{StaticResource EntryStyle}" />
                <!-- VEHICLE -->
                <BoxView Style="{StaticResource SeparatorStyle}"/>
                <Label Text="Vehicle"
                       Style="{StaticResource TicketLabelStyle}"/>
                <Grid>
                    <Entry Grid.Row="0"
                           Grid.Column="0"
                           Text="{Binding Ticket.Vehicle.Make}"
                           Placeholder="Make"
                           Style="{StaticResource EntryStyle}" />
                    <Entry Grid.Row="0"
                           Grid.Column="1"
                           Text="{Binding Ticket.Vehicle.Model}"
                           Placeholder="Model"
                           Style="{StaticResource EntryStyle}" />
                    <Entry Grid.Row="1"
                           Grid.ColumnSpan="2"
                           Text="{Binding Ticket.Vehicle.PlateNo}"
                           Placeholder="Plate No"
                           Style="{StaticResource EntryStyle}" />
                </Grid>
                <!-- VIOLATION -->
                <BoxView Style="{StaticResource SeparatorStyle}"/>
                <Label Text="Details"
                       Style="{StaticResource TicketLabelStyle}"/>
                <controls:BindablePicker SelectedItem="{Binding Ticket.Violation, Mode=TwoWay}"
                                         Style="{StaticResource TrafficPickerStyle}"
                                         ItemsSource="{Binding TrafficViolationTypes}" />

                <Grid IsVisible="{Binding Ticket.Violation, Converter={StaticResource StringToBoolConverter}, ConverterParameter='Speeding'}">
                    <Entry Grid.Row="0"
                           Grid.Column="0"
                           Text="{Binding Ticket.Speed}"
                           Placeholder="Speed"
                           Style="{StaticResource EntryStyle}" />
                    <Entry Grid.Row="0"
                           Grid.Column="1"
                           Text="{Binding Ticket.MaxSpeed}"
                           Placeholder="Max Speed"
                           Style="{StaticResource EntryStyle}" />
                </Grid>
                <BoxView Style="{StaticResource SeparatorStyle}" />
                <Entry Text="{Binding Ticket.Notes}"
                       HeightRequest="80"
                       Placeholder="Note/Violation(s)"
                       Style="{StaticResource EntryStyle}" />
                <Grid>
                    <ActivityIndicator Grid.ColumnSpan="2"
                                       Grid.Row="0"
                                       IsRunning="{Binding IsBusy}"
                                       IsVisible="{Binding IsBusy}"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       Color="{StaticResource BlueColor}">
                        <ActivityIndicator.WidthRequest>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="iOS" Value="100" />
                                <On Platform="Android" Value="100" />
                                <On Platform="WinUI" Value="400" />
                            </OnPlatform>
                        </ActivityIndicator.WidthRequest>
                    </ActivityIndicator>                 
                    <controls:ImageButton Grid.Column="0"
                                          Grid.Row="1"
                                          ImageButtonText="Submit"
                                          ImageButtonCommand="{Binding SubmitTicketCommand}"
                                          VerticalOptions="Center"
                                          HeightRequest="50"
                                          WidthRequest="120"
                                          HorizontalOptions="Center"/>
                    <controls:ImageButton Grid.Column="1"
                                          Grid.Row="1"
                                          ImageButtonText="Cancel"
                                          ImageButtonCommand="{Binding ClosePopupCommand}"
                                          VerticalOptions="Center"
                                          HeightRequest="50"
                                          WidthRequest="120"
                                          HorizontalOptions="Center"/>
                </Grid>
            </StackLayout>
        </controls:NoBarsScrollViewer>
    </Grid>
</toolkit:Popup>
